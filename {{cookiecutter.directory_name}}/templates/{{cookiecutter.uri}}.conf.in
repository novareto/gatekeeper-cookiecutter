LoadModule wsgi_module "${buildout:directory}/lib/python3.5/site-packages/mod_wsgi/server/mod_wsgi-py34.cpython-34m.so"
WSGIPythonHome "${buildout:directory}"

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %D %>D BGHW" combined_ls
<IfModule mod_ssl.c>

<VirtualHost *:443>
  ServerAdmin ${config:conf-global-admin} 
  ServerName ${config:conf-global-uri} 
  LogLevel debug ssl:info
  ErrorLog  /var/log/apache2/${config:conf-global-uri}_error.log
  CustomLog /var/log/apache2/${config:conf-global-uri}_access.log combined_ls

  SSLEngine on
  SSLCertificateFile /etc/apache2/cert/kuvb.de.crt
  SSLCACertificateFile /etc/apache2/cert/kuvb.de-ca.crt
  SSLCertificateKeyFile /etc/apache2/cert/kuvb.de.key

  TKTAuthPublicKey ${buildout:directory}/etc/pubkey.pem
  WSGIDaemonProcess gatekeeper user=uv group=uv threads=1
  WSGIProcessGroup gatekeeper

  <Directory "${buildout:directory}">
    WSGIProcessGroup gatekeeper
    WSGIApplicationGroup %{GLOBAL}
    Require all granted
  </Directory>

  <Location "/static/">
    Options -Indexes
  </Location>
  
  Alias /static/ ${buildout:directory}/static/
  WSGIScriptAlias /login ${buildout:directory}/app.py
  
  <Proxy http://127.0.0.1:8080/*>
    AuthType mod_auth_pubtkt
    TKTAuthLoginURL https://testasd.kuvb.de/login
    TKTAuthTimeoutURL https://testasd-weblogin.kuvb.de/?timeout=1
    TKTAuthUnauthURL https://testasd-weblogin.kuvb.de/?unauth=1
    TKTAuthDebug 0
    TKTAuthFakeBasicAuth on
    TKTAuthPassthruBasicAuth on
    TKTAuthPassthruBasicKey TMUMd7Vf40rXHDyL
    require valid-user
  </Proxy>
</VirtualHost>
